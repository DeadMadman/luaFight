local map = {}

map.collidableTiles = {}
map.decorationTiles = {}
map.backgroundTiles = {}
map.bg = {}
map.tileSize = createVec(16, 16)

map.collision = {
    {79,77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,76,},
    {91,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {51,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {84,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {92,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,73,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {51,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {84,52,79,47,48,66,67,89,45,46,58,46,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {92,91,40,40,40,40,40,40,40,51,68,40,9,7,7,7,7,73,7,7,7,0,0,0,0,0,0,0,0,0,7,7,7,73,7,7,7,0,0,0,0,0,0,86,},
    {40,84,60,60,61,60,61,60,61,15,60,61,62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,52,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {51,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,7,7,7,73,7,7,7,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {91,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,-1,0,0,0,0,0,0,0,0,86,},
    {40,9,7,7,7,73,7,0,0,0,0,0,0,0,7,7,7,73,7,7,7,0,0,0,0,0,0,0,-1,-1,7,7,7,73,7,7,7,-1,-1,0,0,0,0,86,},
    {51,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,41,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {40,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86,},
    {83,52,88,47,48,66,67,58,66,67,66,67,58,45,46,66,47,48,66,67,67,66,67,45,46,47,48,58,45,46,66,67,66,67,58,47,48,45,46,66,67,47,48,98,}
}
map.decoration = {
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,42,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,42,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,14,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,-1,-1,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,26,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,36,37,56,57,19,34,35,49,49,19,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,-1,6,-1,-1,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,70,70,71,70,71,70,71,27,70,71,72,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,42,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,0,0,0,0,0,0,0,10,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,42,-1,0,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,42,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,6,0,-1,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,-1,6,-1,-1,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,},
    {-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,42,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,},
    {-1,-1,19,36,37,56,57,49,56,57,56,57,49,34,35,56,36,37,56,57,57,56,57,34,35,36,37,49,34,35,56,57,56,57,49,36,37,34,35,56,57,36,37,0,},
    {-1,-1,-1,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,},
    } 

map.background = {
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,124,125,122,123,-1,-1,-1,-1,-1,-1,-1,-1,},
    {122,123,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,},
    {40,122,123,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,},
    {40,40,122,123,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,121,40,40,40,40,122,123,-1,-1,-1,-1,-1,-1,-1,},
    {40,40,40,122,123,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,40,40,40,40,40,40,122,123,-1,-1,-1,-1,-1,-1,},
    {40,104,105,40,112,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,40,40,102,40,40,40,40,122,123,-1,-1,-1,-1,-1,},
    {40,114,115,40,122,123,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,40,40,40,40,40,112,-1,-1,-1,-1,-1,},
    {40,114,115,40,51,122,123,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,40,104,128,126,105,40,112,-1,-1,-1,-1,-1,},
    {40,124,125,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,104,105,40,40,114,0,0,115,40,122,123,-1,-1,-1,-1,},
    {-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,114,115,40,40,124,127,127,125,40,40,112,-1,-1,-1,-1,},
    {-1,-1,40,40,40,40,40,40,40,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,124,125,40,40,40,40,40,40,40,40,112,-1,-1,-1,-1,},
    {-1,-1,40,40,40,40,40,40,40,40,40,102,103,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,108,109,40,40,40,40,40,40,40,40,40,40,40,112,-1,-1,-1,120,},
    {-1,-1,40,40,40,104,105,40,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,40,40,118,119,40,40,40,40,40,40,40,40,40,40,40,112,-1,-1,120,121,},
    {-1,-1,106,107,40,114,115,40,40,40,102,103,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,40,40,40,40,40,40,40,122,40,40,40,40,40,40,40,112,-1,-1,111,40,},
    {-1,-1,116,117,40,124,125,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,104,105,40,40,40,40,40,40,104,126,128,105,40,112,-1,-1,111,40,},
    {-1,-1,40,40,40,40,40,40,40,102,103,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,114,115,40,40,40,40,40,40,124,127,127,125,40,122,123,120,121,40,},
    {-1,-1,40,104,105,40,40,40,102,103,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,40,40,40,101,124,125,40,40,40,40,40,40,40,40,40,40,40,40,122,121,40,40,},
    {-1,-1,40,124,125,40,40,102,103,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,111,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,},
    {-1,-1,40,40,40,40,102,103,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,104,105,40,40,40,40,104,128,126,105,40,40,40,40,40,40,40,40,121,40,40,},
    {-1,-1,40,40,40,40,112,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,124,125,40,40,40,40,124,127,127,125,40,40,40,40,40,40,40,40,40,40,40,},
    {-1,104,105,40,40,102,103,0,-1,-1,-1,-1,-1,-1,-1,-1,120,121,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,104,105,40,40,},
    {-1,124,125,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,114,115,-1,-1,}
}
    
function map.createMap()
    require("tile")
    map.bg.spriteSheet = love.graphics.newImage("bg.png")
    map.bg.spriteSheet:setFilter("nearest", "nearest")
    map.bg.spriteSheet:setWrap("repeat", "repeat")
    map.bg.quad = love.graphics.newQuad(0, 0, love.graphics.getWidth(), love.graphics.getHeight(), map.bg.spriteSheet:getDimensions())

    map.createLayer(map.collision, map.collidableTiles)
    map.createLayer(map.decoration, map.decorationTiles)
    map.createLayer(map.background, map.backgroundTiles)
end

function map.createLayer(layer, list)
    for rowIndex, row in ipairs(layer) do  
        for colIndex, type in ipairs(row) do
            if type > 0 then
                local pos = createVec((colIndex - 1) * map.tileSize.x, (rowIndex - 1) * map.tileSize.y)
                local newTile = createTile(pos.x, pos.y, map.tileSize.x, map.tileSize.y, type + 1)
                table.insert(list, newTile)
            end
        end
    end
end

function map.draw()
    love.graphics.draw(map.bg.spriteSheet, map.bg.quad)
    for _, tile in pairs(map.backgroundTiles) do
        tile.drawTile(tile)
    end

    for _, tile in pairs(map.collidableTiles) do
        tile.drawTile(tile)
    end
    for _, tile in pairs(map.decorationTiles) do
        tile.drawTile(tile)
    end
end

function map.update(dt)
    for _, tile in pairs(map.collidableTiles) do
        tile.updateTile(tile, dt)
    end
end

return map